{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Promote draft deployment to live (frontend cache/update readiness)",
  "requirements": [
    {
      "id": "REQ-4",
      "summary": "Ensure the live URL reliably serves the most recently deployed build by preventing stale PWA/service-worker caches and providing clear promotion steps.",
      "acceptanceCriteria": [
        "The latest draft build is promoted to live successfully.",
        "Opening the live app URL shows the same app version and behavior as the most recent draft build.",
        "No new 'draft-only' version remains as the active live deployment after promotion."
      ],
      "file_operations": [
        {
          "path": "frontend/public/sw.js",
          "operation": "modify",
          "description": "Update service worker cache/update behavior to avoid stale assets after a draft-to-live promotion: bump cache name/versioning, add a message handler to support immediate activation (skip-waiting) when a new worker is installed, and ensure old caches are cleaned so the live URL fetches the newest build assets."
        },
        {
          "path": "frontend/src/utils/pwa.ts",
          "operation": "modify",
          "description": "Enhance service worker registration to detect updates and trigger a controlled refresh to the newest live build (e.g., when a waiting worker exists, request skip-waiting and reload after controller change). Keep any user-facing text in English."
        },
        {
          "path": "frontend/DEPLOYMENT.md",
          "operation": "create",
          "description": "Add concise, English documentation describing the operational steps/checklist to promote the current draft deployment to live and verify the live URL is serving the latest build (including guidance to validate service worker update behavior and hard-refresh expectations)."
        }
      ]
    }
  ]
}