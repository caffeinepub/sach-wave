{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Profile page: never-stuck loading with explicit error + retry",
  "requirements": [
    {
      "id": "REQ-3",
      "summary": "Add explicit error handling and retry UI for profile fetch failures so the Profile page never appears stuck, while keeping the existing not-found state for genuine null profiles.",
      "acceptanceCriteria": [
        "When the profile fetch fails (network/agent error or backend trap), the Profile page displays an error UI (in English) with a Retry button that re-attempts loading.",
        "When the profile fetch succeeds, the Profile page renders as it does today.",
        "When the profile is genuinely missing (null response), the Profile page shows the existing 'Profile not found' empty state (not an error state)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Update the useGetUserProfile query to (1) avoid misclassifying thrown query errors as a null profile, (2) treat only truly missing/invalid-user cases as null (to preserve the current 'Profile not found' flow), and (3) disable/limit automatic retries so the Profile page can deterministically show an error state and rely on an explicit user-driven Retry (via refetch)."
        },
        {
          "path": "frontend/src/pages/profile/ProfilePage.tsx",
          "operation": "modify",
          "description": "Use the query error state from useGetUserProfile (isError/error) to render a clear error UI instead of falling through to the 'Profile not found' view. Use the existing PageState.ErrorState component to show an English error message and a Retry button that triggers a re-attempt (refetch the profile query, and optionally refetch dependent data such as posts when appropriate) so the page never appears stuck."
        }
      ]
    }
  ]
}